# CVE-2017-12615Tomcat远程代码执行漏洞

**漏洞介绍**

远程代码执行漏洞（CVE-2017-12615） 影响：Apache Tomcat 7.0.0 - 7.0.79（7.0.81修复不完全）当 Tomcat 运行在 Windows  主机上，且启用了 HTTP PUT 请求方法，攻击者通过构造的攻击请求向服务器上传包含任意代码的 JSP 文件，造成任意代码执行，危害十分严重

**影响版本**

 `Apache Tomcat 7.0.0 - 7.0.81`

**漏洞利用前提:**

 需Tomcat开启了HTTP PUT请求
 
 打开Tomcat安装目录的Tomcat7.0.x\conf\web.xml添加配置，
 在Tomcat7.0版本下默认配置是开启readonly的，需要手动配置readonly为false才可以进行漏洞利用。
 ```
 <init-param> 
        <param-name>readonly</param-name> 
        <param-value>false</param-value> 
</init-param> 
 ```

**漏洞原理分析**

Tomcat 的 Servlet 是在 conf/web.xml 配置的，通过配置文件可知，当后缀名为 .jsp 和 .jspx 的时候，是通过  JspServlet 处理请求的：而其他的静态文件是通过 DefaultServlet 处理的：可以得知，“1.jsp  ”（末尾有一个和空格）并不能匹配到JspServlet，而是会交由 DefaultServlet 去处理。
当处理 PUT 请求时：会调用 resources.bind：dirContext 为 FileDirContext：调用 rebind 创建文件：又由于 Windows 不允许“ ”作为文件名结尾，所以会创建一个 .jsp 文件，导致代码执行。

**该漏洞实际上是利用了window下文件名解析的漏洞来触发的**。通过构造特殊后缀名，绕过Tomcat检测，让Tomcat用DefaultServlet的逻辑处理请求，从而上传jsp webshell文件
有三种方法可以进行绕过

```
shell.jsp%20
shell.jsp::$DATA
shell.jsp/
```
